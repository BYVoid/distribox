# Distribox 需求文档

# 功能需求
## 概述
Distribox是一个基于P2P算法的文件共享工具，每个客户端可以加入一个P2P网络相互共享文件。文件共享的方式与Dropbox或Google Drive相似，即监视一个文件夹的所有变动，在客户端之间互相同步。与Dropbox之类的产品不同，Distribox需要是一个完全去中心化的系统，没有云端，也没有任何一个节点是中心，或被称为服务器。
## 概念描述
* 同步根目录：Distribox监视并同步的目录，其中所有的文件及子目录会被同步
* 版本： 每个版本包括：
 * 时间戳：文件的本地修改时间
 * 散列值：文件内容的SHA1散列值
 * 文件名：文件名称以及相对于同步根目录的路径
 * 文件内容：文件的二进制内容
* 节点：相互同步文件的客户端
## 文件系统监视
Distribox应该实现一个文件系统动作监控的模块，即对一个目录（及其子目录）下所有的文件创建、修改、删除、更名等操作进行监控，并产生事件。
## 版本管理
Distribox应该能够对文件的版本进行维护，任何文件的动作都被认为是产生了一个新的版本，Distribox应该维护所有的版本。
当不同节点之间对一个文件产生了冲突的修改，Distribox应该将所有的版本保留，并产生分支，用户可以选择工作分支。
用户可以在任何时间回退到过去的任意一个版本，包括自己产生的版本和其他节点产生的版本。版本之间不需要自动合并。
每个节点都应该维护一份完整的版本拷贝，包括所有节点再所有时间的所有改动产生的所有版本。
## 版本呈现
Distribox在大部分时候应该呈现给用户时间戳最新的版本。
在特殊情况下，如中间的不一致状态或文件被其他程序锁定时，呈现的版本可以不是最新的，但最终需要呈现最新的版本。
## 节点加入
Distribox的节点之间组成一个完全去中心化的点对点网络，任何节点新加入必须经过现有节点的邀请。被邀请的节点可以加入点对点网络，离开网络以后再加入不需要再邀请。每个节点应该维护一个完整的网络节点列表。
## 点对点传输
文件版本的同步应该是点对点的，任何一个节点产生了新的版本都会通过点对点传输在其他所有节点上反映出。

# 质量需求
## 断点续传
传送大文件时，如果连接中途终止，Distribox应能继续之前的传输。
## 并发传输
Distribox应能同时与多个节点同步。
Distribox应能同时从多个节点得到同一个文件，以提升连接速度。
## 压缩传输
在传送小文件时，Distribox应该将小文件合并成1MB以上的包传输以减少网络传输开销。
## 健壮性
Distribox应该对断电、连接意外终止及任何其他外部错误保证健壮性。数据的最终一致性不应受到这些因素的影响。
## 性能
Distribox应在平均10%系统资源之内以处理小目录同样数量级的速度处理约10000个文件的目录。
## 文件一致性
在某个时刻的节点状态之间不一致是可以容忍的，但应该满足最终一致性。
## 对其他程序的影响
因Distribox对文件的锁定造成其他程序不能正常运行的情况应该控制在10%以内。
## 同步速度
对于百兆以太网环境，Distribox在两个节点同步的速度应基本达到这两个节点的网络带宽。对更加高速的网络环境的传输速度不应更慢。

# 接口需求
## 动态链接库
Distribox需要提供一个可供程序加载的动态链接库，如Distribox.dll。
动态链接库应包含Distribox的所有不涉及用户交互的基本功能。
## 命令行程序
Distribox需要提供一个命令行程序，可以运行在没有图形界面的环境下，如服务器。
命令行程序的功能应该包含Distribox的所有功能，并使用命令行的方式实现。
## 图形用户界面
Distribox应该提供基本的图形用户界面，以面向最终用户在桌面环境的使用。
图形用户界面应该包含Distribox的所有功能，并提供用户友好的图形界面。

# 软件需求
## 管理需求
Distribox的参数应该可配置，包括监控路径、本地端口、最大连接数、版本列表名称。
## 技术需求
### 运行环境
跨平台，支持Windows、Mac OS、Linux。
## 文档需求
### 设计文档
使用Visual Studio UML工具进行建模。
### API文档
通过Doxygen生成软件类结构的文档。
### 缺陷管理
已知的软件缺陷应通过Git9(http://git.net9.org)管理。
