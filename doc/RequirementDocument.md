# Distribox 需求文檔

# 功能需求
## 概述
Distribox是一個基於P2P算法的文件共享工具，每個客戶端可以加入一個P2P網絡相互共享文件。文件共享的方式與Dropbox或Google Drive相似，即監視一個文件夾的所有變動，在客戶端之間互相同步。與Dropbox之類的產品不同，Distribox需要是一個完全去中心化的系統，沒有雲端，也沒有任何一個節點是中心，或被稱爲服務器。
## 概念描述
* 同步根目錄：Distribox監視並同步的目錄，其中所有的文件及子目錄會被同步
* 版本： 每個版本包括：
 * 時間戳：文件的本地修改時間
 * 散列值：文件內容的SHA1散列值
 * 文件名：文件名稱以及相對於同步根目錄的路徑
 * 文件內容：文件的二進制內容
* 節點：相互同步文件的客戶端
## 文件系統監視
Distribox應該實現一個文件系統動作監控的模塊，即對一個目錄（及其子目錄）下所有的文件創建、修改、刪除、更名等操作進行監控，並產生事件。
## 版本管理
Distribox應該能夠對文件的版本進行維護，任何文件的動作都被認爲是產生了一個新的版本，Distribox應該維護所有的版本。
當不同節點之間對一個文件產生了衝突的修改，Distribox應該將所有的版本保留，並產生分支，用戶可以選擇工作分支。
用戶可以在任何時間回退到過去的任意一個版本，包括自己產生的版本和其他節點產生的版本。版本之間不需要自動合併。
每個節點都應該維護一份完整的版本拷貝，包括所有節點再所有時間的所有改動產生的所有版本。
## 版本呈现
Distribox在大部分时候应该呈现给用户时间戳最新的版本。
在特殊情况下，如中间的不一致状态或文件被其他程序锁定时，呈现的版本可以不是最新的，但最终需要呈现最新的版本。
## 節點加入
Distribox的節點之間組成一個完全去中心化的點對點網絡，任何節點新加入必須經過現有節點的邀請。被邀請的節點可以加入點對點網絡，離開網絡以後再加入不需要再邀請。每個節點應該維護一個完整的網絡節點列表。
## 點對點傳輸
文件版本的同步應該是點對點的，任何一個節點產生了新的版本都會通過點對點傳輸在其他所有節點上反映出。

# 质量需求
## 断点续传
传送大文件时，如果连接中途终止，Distribox应能继续之前的传输。
## 并发传输
Distribox应能同时与多个节点同步。
Distribox应能同时从多个节点得到同一个文件，以提升连接速度。
## 压缩传输
在传送小文件时，Distribox应该将小文件合并成1MB以上的包传输以减少网络传输开销。
## 健壮性
Distribox应该对断电、连接意外终止及任何其他外部错误保证健壮性。数据的最终一致性不应受到这些因素的影响。
## 性能
Distribox应在平均10%系统资源之内以处理小目录同样数量级的速度处理约10000个文件的目录。
## 文件一致性
在某個時刻的節點狀態之間不一致是可以容忍的，但應該滿足最終一致性。
## 对其他程序的影响
因Distribox对文件的锁定造成其他程序不能正常运行的情况应该控制在10%以内。
## 同步速度
对于百兆以太网环境，Distribox在两个节点同步的速度应基本达到这两个节点的网络带宽。对更加高速的网络环境的传输速度不应更慢。

# 接口需求
## 動態鏈接庫
Distribox需要提供一個可供程序加載的動態鏈接庫，如Distribox.dll。
動態鏈接庫應包含Distribox的所有不涉及用戶交互的基本功能。
## 命令行程序
Distribox需要提供一個命令行程序，可以運行在沒有圖形界面的環境下，如服務器。
命令行程序的功能應該包含Distribox的所有功能，並使用命令行的方式實現。
## 圖形用戶界面
Distribox應該提供基本的圖形用戶界面，以面向最終用戶在桌面環境的使用。
圖形用戶界面應該包含Distribox的所有功能，並提供用戶友好的圖形界面。

# 軟件需求
## 管理需求
Distribox的參數應該可配置，包括監控路徑、本地端口、最大连接数、版本列表名称。
## 技術需求
### 運行環境
跨平臺，支持Windows、Mac OS、Linux。
## 文檔需求
### 設計文檔
使用Visual Studio UML工具進行建模。
### API文檔
通過Doxygen生成軟件類結構的文檔。
### 缺陷管理
已知的软件缺陷应通过Git9(http://git.net9.org)管理。
