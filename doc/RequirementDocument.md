# Distribox 需求文檔

# 功能需求
## 概述
Distribox應該實現一個基於P2P的文件共享工具，每個客戶端可以加入相互共享文件。文件共享的方式與Dropbox或Google Drive相似，即監視一個文件夾的所有變動，在客戶端之間互相同步。與Dropbox之類的產品不同，Distribox需要是一個完全去中心化的系統，沒有雲端，也沒有任何一個節點是中心服務器，所有的數據都被存儲在每個節點上。
## 概念描述
* 同步根目錄：Distribox監視並同步的目錄，其中所有的文件及子目錄會被同步
* 版本： 每個版本包括：
 * 時間戳：文件的本地修改時間
 * 散列值：文件內容的SHA1散列值
 * 文件名：文件名稱以及相對於同步根目錄的路徑
 * 文件內容：文件的二進制內容
* 節點：相互同步文件的客戶端

## 文件系統監視
Distribox應該實現一個文件系統動作監控的模塊，即對一個目錄（及其子目錄）下所有的文件創建、修改、刪除、更名等操作進行監控，並產生相應的事件。
## 版本管理
Distribox應該能夠對文件的版本進行維護，任何文件的動作都被認爲是產生了一個新的版本，Distribox應該維護所有的版本。當不同節點之間對一個文件產生了衝突的修改，Distribox應該將所有的版本保留，並產生分支，用戶可以選擇工作分支。用戶可以在任何時間回退到過去的任意一個版本，包括自己產生的版本和其他節點產生的版本。版本之間不需要自動合併。

每個節點都應該維護一份完整的版本拷貝，包括所有節點再所有時間的所有改動產生的所有版本。
## 節點加入
Distribox的節點之間組成一個完全去中心化的點對點網絡，任何節點新加入必須經過現有節點的邀請。被邀請的節點可以加入點對點網絡，離開網絡以後再加入不需要再邀請。每個節點應該維護一個完整的網絡節點列表。
## 點對點傳輸
文件版本的同步應該是點對點的，任何一個節點產生了新的版本都會通過點對點傳輸在其他所有節點上反映出。
在某個時刻的節點狀態之間不一致是可以容忍的，但應該滿足最終一致性。

# 接口需求
## 動態鏈接庫
Distribox需要提供一個可供程序加載的動態鏈接庫，如`Distribox.dll`。
動態鏈接庫應包含Distribox的所有不涉及用戶交互的基本功能。
## 命令行程序
Distribox需要提供一個命令行程序，可以運行在沒有圖形界面的環境下，如服務器。
命令行程序的功能應該包含Distribox的所有功能，並使用命令行的方式實現。
命令行程序在無參數啓動時，應該進入一個文字交互界面，用戶可以通過輸入一些命令實現所需功能。
## 圖形用戶界面
Distribox應該提供基本的圖形用戶界面，以面向最終用戶在桌面環境的使用。
圖形用戶界面應該包含Distribox的所有功能，並提供用戶友好的圖形界面。

# 軟件需求
## 管理需求
Distribox的參數應該可配置，包括監控路徑、本地端口，以及其他的性能參數選擇。
## 技術需求
### 運行環境
要求跨平臺，支持Windows、Mac OS、Linux。
## 文檔需求
### 設計文檔
使用UML工具進行建模，並給出完整的模塊設計。
### API文檔
通過C# XML文檔生成軟件類結構的文檔。
